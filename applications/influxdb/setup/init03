if [[ ! -d /data/db ]]; then
	echo "=> Detected an uninitialized InfluxDB data volume"
	echo "=> Setup InfluxDB ..."

	mkdir -p "/data/db"
	mkdir -p  "/data/meta"
else
    echo "=> Using an existing InfluxDB data volume"
fi

if [ -n "${HOSTNAME}" ]; then
    if [ "${HOSTNAME}" == "auto" ]; then
        HOSTNAME=$(hostname')
    fi

	/usr/bin/perl -p -i -e "s/^# hostname.*$/hostname = \"${HOSTNAME}\"/g" /config/config.toml
fi

chown -R core:core /data